{% extends 'base.html' %}
{% block title %}
{{ title_name }}
{% endblock %}
{% block content %}

<link rel="stylesheet" href="/static/verification/verifications_control/css/create.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

<div class="create-page container px-3">
  <h1 class="text-center mb-5">{{ title_name }}</h1>

  <div class="back-btn-wrapper text-center my-3">
    <a href="/verification/?company_id={{company_id}}" class="btn btn-home fw-bold">
      üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
  </div>

  <div class="create-form-wrapper">
    <form id="add-entry-form" method="post" enctype="multipart/form-data">
      <h2 class="form-title mb-4">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–π –ø–æ–≤–µ—Ä–∫–µ</h2>
      <div class="form-content row rounded-section">
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="employee_full_name" class="form-label text-truncate">–§–ò–û —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</label>
          <input type="text" id="employee_full_name" class="form-control"
            value="{{ last_name }} {{ name }} {{ patronymic }}" disabled />
        </div>
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="series_id" class="form-label text-truncate">–°–µ—Ä–∏—è –±–ª–∞–Ω–∫–∞</label>
          {% if status in ["admin", "director"] %}
          <select id="series_id" name="series_id" class="form-select">
            {% for s in series %}
            <option value="{{ s.id }}" {% if default_series_id and s.id==default_series_id %} selected {% endif %}>
              {{ s.name }}
            </option>
            {% endfor %}
          </select>
          {% else %}
          {% if employee_series %}
          <input type="hidden" name="series_id" value="{{ employee_series.id }}">
          <select id="series_id" name="series_id" class="form-select" disabled required>
            <option value="{{ employee_series.id }}" selected>{{ employee_series.name }}</option>
          </select>
          {% else %}
          <select id="series_id" name="series_id" class="form-select">
            {% for s in series %}
            <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>
          {% endif %}
          {% endif %}
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="act_number" class="form-label text-truncate">–ù–æ–º–µ—Ä –±–ª–∞–Ω–∫–∞</label>
          <input type="text" id="act_number" name="act_number" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –±–ª–∞–Ω–∫–∞"
            required inputmode="numeric" pattern="[0-9]*" />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="registry_number_id" class="form-label text-truncate">–ù–æ–º–µ—Ä –≥–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞</label>
          <select id="registry_number_id" name="registry_number_id" class="form-select select2 h-100" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä –≥–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞</option>
            {% for reg in registry_numbers %}
            <option value="{{ reg.id }}">{{ reg.registry_number }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="modification_id" class="form-label text-truncate">–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –°–ò</label>
          <select id="modification_id" name="modification_id" class="form-select">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="manufacture_year" class="form-label text-truncate">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –ø–æ–≤–µ—Ä—è–µ–º–æ–≥–æ –°–ò</label>
          <select id="manufacture_year" name="manufacture_year" class="form-select" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="si_type" class="form-label text-truncate">–¢–∏–ø –°–ò</label>
          <input type="text" id="si_type" class="form-control" disabled />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="water_type" class="form-label text-truncate">–¢–∏–ø –≤–æ–¥—ã</label>
          <select id="water_type" name="water_type" class="form-select" required>
            <option value="cold" selected>–•–æ–ª–æ–¥–Ω–∞—è</option>
            <option value="hot">–ì–æ—Ä—è—á–∞—è</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="verification_date" class="form-label text-truncate">–î–∞—Ç–∞ –ø–æ–≤–µ—Ä–∫–∏</label>
          <input type="date" id="verification_date" name="verification_date" class="form-control" />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="interval" class="form-label text-truncate">–°–ª–µ–¥—É—é—â–∞—è –ø–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑</label>
          <select id="interval" name="interval" class="form-select" required>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="end_verification_date" class="form-label text-truncate">–°—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–≤–µ—Ä–∫–∏</label>
          <input type="date" id="end_verification_date" name="end_verification_date" class="form-control" required />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="location_id" class="form-label text-truncate">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞</label>
          <select id="location_id" name="location_id" class="form-select" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</option>
            {% for location in locations %}
            <option value="{{ location.id }}">{{ location.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="factory_number" class="form-label text-truncate">–ó–∞–≤–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä</label>
          <input type="text" id="factory_number" name="factory_number" class="form-control"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≤–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä" required />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="seal" class="form-label text-truncate">–ü–ª–æ–º–±–∞ –†–°–û</label>
          <select id="seal" name="seal" class="form-select" required>
            <option value="present" selected>–ï—Å—Ç—å</option>
            <option value="damaged">–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∞</option>
            <option value="missing">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="meter_info" class="form-label text-truncate">–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞</label>
          <input type="number" id="meter_info" name="meter_info" class="form-control"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞" required />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="city_id" class="form-label text-truncate">–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</label>
          <select id="city_id" name="city_id" class="form-select" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</option>
            {% for city in cities %}
              {% if default_city_id and default_city_id == city.id %}
              <option value="{{ city.id }}" selected>{{ city.name }}</option>
              {% else %}
              <option value="{{ city.id }}">{{ city.name }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="address" class="form-label text-truncate">–ê–¥—Ä–µ—Å</label>
          <input type="text" id="address" name="address" class="form-control" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å" />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="client_full_name" class="form-label text-truncate">–í–ª–∞–¥–µ–ª–µ—Ü –°–ò</label>
          <input type="text" id="client_full_name" name="client_full_name" class="form-control" required
            placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û" />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="legal_entity" class="form-label text-truncate">–§–∏–∑./–Æ—Ä. –ª–∏—Ü–æ</label>
          <select id="legal_entity" name="legal_entity" class="form-select" required>
            <option value="individual" selected>–§–∏–∑. –ª–∏—Ü–æ</option>
            <option value="legal">–Æ—Ä. –ª–∏—Ü–æ</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="client_phone" class="form-label text-truncate">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
          <input type="tel" class="form-control" id="client_phone" name="client_phone"
            placeholder="+7 (___) ___-__-__" />
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="method_id" class="form-label text-truncate">–ú–µ—Ç–æ–¥–∏–∫–∞</label>
          <select id="method_id" name="method_id" class="form-select" required>
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥–∏–∫—É</option>
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="verification_result" class="form-label text-truncate">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≤–µ—Ä–∫–∏</label>
          <select id="verification_result" name="verification_result" class="form-select" required>
            <option value="True" selected>–ü—Ä–∏–≥–æ–¥–Ω–æ</option>
            <option value="False">–ù–µ–ø—Ä–∏–≥–æ–¥–Ω–æ</option>
          </select>
        </div>

        <div id="additional_input" class="col-md-3 mb-3 flex-grow-1" style="display: none;">
          <label for="reason_id" class="form-label text-truncate">–ü—Ä–∏—á–∏–Ω–∞ –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç–∏</label>
          <select id="reason_id" name="reason_id" class="form-select">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É</option>
            {% for reason in reasons %}
            <option value="{{ reason.id }}">{{ reason.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="legal_entity_status">
            –ü–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="legal_entity_status" name="legal_entity_status"
              value="True" style="transform: scale(2);">
          </div>
        </div>

        {% if additional_checkbox_1 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="additional_checkbox_1">
            {{ additional_checkbox_1 }}
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="additional_checkbox_1" name="additional_checkbox_1"
              value="True" style="transform: scale(2);">
          </div>
        </div>
        {% endif %}
        {% if additional_checkbox_2 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="additional_checkbox_2">
            {{ additional_checkbox_2 }}
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="additional_checkbox_2" name="additional_checkbox_2"
              value="True" style="transform: scale(2);">
          </div>
        </div>
        {% endif %}
        {% if additional_checkbox_3 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="additional_checkbox_3">
            {{ additional_checkbox_3 }}
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="additional_checkbox_3" name="additional_checkbox_3"
              value="True" style="transform: scale(2);">
          </div>
        </div>
        {% endif %}
        {% if additional_checkbox_4 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="additional_checkbox_4">
            {{ additional_checkbox_4 }}
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="additional_checkbox_4" name="additional_checkbox_4"
              value="True" style="transform: scale(2);">
          </div>
        </div>
        {% endif %}
        {% if additional_checkbox_5 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex justify-content-center align-items-center flex-column">
          <label class="form-check-label text-start w-100 mb-3 text-truncate" for="additional_checkbox_5">
            {{ additional_checkbox_5 }}
          </label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="additional_checkbox_5" name="additional_checkbox_5"
              value="True" style="transform: scale(2);">
          </div>
        </div>
        {% endif %}

        {% if additional_input_1 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="additional_input_1" class="form-label text-truncate">{{ additional_input_1 }}</label>
          <input type="text" class="form-control" id="additional_input_1" name="additional_input_1" />
        </div>
        {% endif %}
        {% if additional_input_2 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="additional_input_2" class="form-label text-truncate">{{ additional_input_2 }}</label>
          <input type="text" class="form-control" id="additional_input_2" name="additional_input_2" />
        </div>
        {% endif %}
        {% if additional_input_3 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="additional_input_3" class="form-label text-truncate">{{ additional_input_3 }}</label>
          <input type="text" class="form-control" id="additional_input_3" name="additional_input_3" />
        </div>
        {% endif %}
        {% if additional_input_4 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="additional_input_4" class="form-label text-truncate">{{ additional_input_4 }}</label>
          <input type="text" class="form-control" id="additional_input_4" name="additional_input_4" />
        </div>
        {% endif %}
        {% if additional_input_5 %}
        <div class="col-md-3 mb-3 flex-grow-1 d-flex flex-column">
          <label for="additional_input_5" class="form-label text-truncate">{{ additional_input_5 }}</label>
          <input type="text" class="form-control" id="additional_input_5" name="additional_input_5" />
        </div>
        {% endif %}

        <div class="col-md-6 mb-3 flex-grow-1 d-flex flex-column">
          <label for="verification_images" class="form-label text-truncate">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ {{image_limit_per_verification}} —Ñ–∞–π–ª–æ–≤)
          </label>
          <input 
            type="file" id="verification_images"
            name="verification_images" class="form-control"
            accept="image/*" multiple />
          <div class="form-text text-truncate">
            –ú–∞–∫—Å–∏–º—É–º {{image_limit_per_verification}} —Ñ–∞–π–ª–æ–≤: jpeg, jpg, png, heic, heif, webp.
          </div>
        </div>
        <div class="col-12 d-flex justify-content-end form-actions">
          <button id="add-entry" type="submit" class="btn btn-save fw-bold">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="add-entry-and-metrolog" type="submit" class="btn btn-protocol fw-bold">üìÑ –ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–≤–µ—Ä–∫–∏</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/imask@7.6.0/dist/imask.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

<script>
  window.userStatus = {{ status | default(None) | tojson | safe }};
  window.defaultCityId = {{ default_city_id | default(None) | tojson | safe }};
  window.photoLimit = {{ image_limit_per_verification | default(None) | tojson | safe }};
  window.autoManufYear = {{ auto_manufacture_year | default(None) | tojson | safe }};
  window.companyId = {{ company_id | default(None) | tojson | safe }};
  window.companyTz = {{ company_tz | default('Europe/Moscow') | tojson | safe }};
</script>

<script type="module" src="/static/verification/verifications_control/js/create.js"></script>

{% endblock %}